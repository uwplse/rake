#lang rosette/safe

(require
  (only-in racket/base error)
  (only-in racket/struct make-constructor-style-printer)
  rosette/lib/destruct
  rake/cpp/types
)

(provide (prefix-out fpir: (all-defined-out)))

;; x86 AVX/AVX2 vector types
(struct i8x16 (value) #:transparent)
(struct i16x8 (value) #:transparent)
(struct i32x4 (value) #:transparent)
(struct i64x2 (value) #:transparent)
(struct i8x32 (value) #:transparent)
(struct i16x16 (value) #:transparent)
(struct i32x8 (value) #:transparent)
(struct i64x4 (value) #:transparent)
(struct u8x16 (value) #:transparent)
(struct u16x8 (value) #:transparent)
(struct u32x4 (value) #:transparent)
(struct u64x2 (value) #:transparent)
(struct u8x32 (value) #:transparent)
(struct u16x16 (value) #:transparent)
(struct u32x8 (value) #:transparent)
(struct u64x4 (value) #:transparent)

(struct add (a b) #:transparent)                            ;; add | add
(struct add_h (a b) #:transparent)                          ;; add_h | halving_add
(struct add_rh (a b) #:transparent)                         ;; add_rh | rounding_halving_add
(struct add_s (a b) #:transparent)                          ;; add_s | saturating_add
(struct add_w (a b) #:transparent)                          ;; add_w | widening_add
(struct broadcast128 (a_imm8) #:transparent)                ;; broadcast128 | broadcast
(struct broadcast256 (a_imm8) #:transparent)                ;; broadcast256 | broadcast
(struct bwand (a b) #:transparent)                          ;; bwand | bitwise_and
(struct bwnot (a b) #:transparent)                          ;; bwnot | bitwise_not
(struct bwor (a b) #:transparent)                           ;; bwor | bitwise_or
(struct max (a b) #:transparent)                            ;; max | max
(struct min (a b) #:transparent)                            ;; min | min
(struct mul (a b) #:transparent)                            ;; mul | mul
(struct mul-vs (a b_imm8) #:transparent)                    ;; mul | mul
(struct mul_shr (a b c) #:transparent)                      ;; mul_shr | mul_shift_right
(struct mul_shr_r (a b c) #:transparent)                    ;; mul_shr_r | rounding_mul_shift_right
(struct mul_w (a b) #:transparent)                          ;; mul_w | widening_mul
(struct mul_w-vs (a b_imm8) #:transparent)                  ;; mul_w | widening_mul
(struct narrow (a) #:transparent)                           ;; narrow | narrow
(struct narrow_s (a) #:transparent)                         ;; narrow_s | saturating_narrow
(struct shl (a b) #:transparent)                            ;; shl | shift_left
(struct shl_r (a b) #:transparent)                          ;; shl_r | rounding_shift_left
(struct shl_w (a b) #:transparent)                          ;; shl_w | widening_shift_left
(struct shr (a b) #:transparent)                            ;; shr | shift_right
(struct shr_r (a b) #:transparent)                          ;; shr_r | rounding_shift_right
(struct shr_w (a b) #:transparent)                          ;; shr_w | widening_shift_right
(struct sub (a b) #:transparent)                            ;; sub | sub
(struct sub_h (a b) #:transparent)                          ;; sub_h | halving_sub
(struct sub_rh (a b) #:transparent)                         ;; sub_rh | rounding_halving_sub
(struct sub_s (a b) #:transparent)                          ;; sub_s | saturating_sub
(struct sub_w (a b) #:transparent)                          ;; sub_w | widening_sub
(struct widen (a) #:transparent)                            ;; widen | widen
(struct reinterpret (a) #:transparent)
;; x86 instructions for vector creation
(struct ld (buf loc align output-type) #:transparent)

;; No-ops to read only the lo or hi bits of a vector
(struct lo (vec) #:transparent)
(struct hi (vec) #:transparent)

;; Concat vectors (not an intrinsic but a useful construct)
(struct concat-tiles (vecs) #:transparent)

;; TODO: these are not currently auto-generated
(struct ??shuffle (id lds output-type) #:transparent)

(struct ??load (id live-data buffer gather-tbl output-type)
  #:transparent
  #:methods gen:custom-write
  [(define write-proc
     (make-constructor-style-printer
      (lambda (obj) `fpir:??load)
      (lambda (obj) (list (??load-id obj) (??load-buffer obj) (??load-output-type obj)))))]
  #:methods gen:equal+hash
  [(define (equal-proc a b equal?-recur)
     (and
      (equal?-recur (??load-id a) (??load-id b))
      (equal?-recur (??load-buffer a) (??load-buffer b))
      (equal?-recur (??load-output-type a) (??load-output-type b))))
   (define (hash-proc a hash-recur) (??load-id a))
   (define (hash2-proc a hash2-recur) (??load-id a))])

(struct ??swizzle (id live-data exprs gather-tbl output-type)
  #:transparent
  #:methods gen:custom-write
  [(define write-proc
     (make-constructor-style-printer
      (lambda (obj) `fpir:??swizzle)
      (lambda (obj) (list (??swizzle-id obj) (length (??swizzle-exprs obj)) (??swizzle-output-type obj)))))]
  #:methods gen:equal+hash
  [(define (equal-proc a b equal?-recur)
     (and
      (equal?-recur (??swizzle-output-type a) (??swizzle-output-type b))
      (equal?-recur (??swizzle-id a) (??swizzle-id b))
      (equal?-recur (??swizzle-live-data a) (??swizzle-live-data b))
      (equal?-recur (??swizzle-exprs a) (??swizzle-exprs b))))
   (define (hash-proc a hash-recur) (??swizzle-id a))
   (define (hash2-proc a hash2-recur) (??swizzle-id a))])

(struct ??abstr-load (id live-data buffer)
  #:transparent
  #:methods gen:custom-write
  [(define write-proc
     (make-constructor-style-printer
      (lambda (obj) `fpir:??abstr-load)
      (lambda (obj) (list (??abstr-load-buffer obj)))))])

;; New types to represent abstract computation (these types should never appear in output code)
(struct abstr-expr (orig-expr abstr-vals offset type)
  #:transparent
  #:methods gen:custom-write
  [(define write-proc
     (make-constructor-style-printer
      (lambda (obj) `fpir:abstr-expr)
      (lambda (obj) (list (abstr-expr-type obj)))))])

(struct ??sub-expr (exprs c type)
  #:transparent
  #:methods gen:custom-write
  [(define write-proc
     (make-constructor-style-printer
      (lambda (obj) `fpir:??sub-expr)
      (lambda (obj) (if (concrete? (??sub-expr-c obj))
                        (list (list-ref (??sub-expr-exprs obj) (??sub-expr-c obj)) (??sub-expr-type obj))
                        (list (length (??sub-expr-exprs obj)) (??sub-expr-c obj) (??sub-expr-type obj))))))])


(struct instr-sig (ret-val args) #:transparent)

(define (instr-forms instr)
  (cond
    [(eq? add instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? add_h instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? add_rh instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? add_s instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? add_w instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u16x16 (list 'u8x16 'uint8))
                         (instr-sig 'u32x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u32x8 (list 'u16x8 'uint16))
                         (instr-sig 'u64x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u64x4 (list 'u32x4 'uint32))
                         (instr-sig 'i16x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i16x16 (list 'i8x16 'int8))
                         (instr-sig 'i32x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i32x8 (list 'i16x8 'int16))
                         (instr-sig 'i64x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i64x4 (list 'i32x4 'int32))
                        )]

    [(eq? broadcast128 instr) (list
                         (instr-sig 'i8x16 (list 'int8))
                         (instr-sig 'u8x16 (list 'uint8))

                         (instr-sig 'i8x16 (list 'int8))
                         (instr-sig 'u8x16 (list 'uint8))

                         (instr-sig 'i16x8 (list 'int16))
                         (instr-sig 'u16x8 (list 'uint16))

                         (instr-sig 'i16x8 (list 'int16))
                         (instr-sig 'u16x8 (list 'uint16))

                         (instr-sig 'i32x4 (list 'int32))
                         (instr-sig 'u32x4 (list 'uint32))

                         (instr-sig 'i32x4 (list 'int32))
                         (instr-sig 'u32x4 (list 'uint32))

                         (instr-sig 'i64x2 (list 'int64))
                         (instr-sig 'u64x2 (list 'uint64))

                         (instr-sig 'i64x2 (list 'int64))
                         (instr-sig 'u64x2 (list 'uint64))

                        )]

    [(eq? broadcast256 instr) (list
                         (instr-sig 'i8x32 (list 'int8))
                         (instr-sig 'u8x32 (list 'uint8))

                         (instr-sig 'i8x32 (list 'int8))
                         (instr-sig 'u8x32 (list 'uint8))

                         (instr-sig 'i16x16 (list 'int16))
                         (instr-sig 'u16x16 (list 'uint16))

                         (instr-sig 'i16x16 (list 'int16))
                         (instr-sig 'u16x16 (list 'uint16))

                         (instr-sig 'i32x8 (list 'int32))
                         (instr-sig 'u32x8 (list 'uint32))

                         (instr-sig 'i32x8 (list 'int32))
                         (instr-sig 'u32x8 (list 'uint32))

                         (instr-sig 'i64x4 (list 'int64))
                         (instr-sig 'u64x4 (list 'uint64))

                         (instr-sig 'i64x4 (list 'int64))
                         (instr-sig 'u64x4 (list 'uint64))

                        )]

    [(eq? bwand instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? bwnot instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? bwor instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? max instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? min instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? mul instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                        )]

    [(eq? mul-vs instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? mul_shr instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32 'uint8))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8 'uint8))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8 'u8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32 'u8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32 'uint8))
                         (instr-sig 'i8x32 (list 'i8x32 'int8 'uint8))
                         (instr-sig 'i8x32 (list 'i8x32 'int8 'u8x32))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16 'uint16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16 'uint16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16 'u16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16 'u16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16 'uint16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16 'uint16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16 'u16x16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8 'uint32))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32 'uint32))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32 'u32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8 'u32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8 'uint32))
                         (instr-sig 'i32x8 (list 'i32x8 'int32 'uint32))
                         (instr-sig 'i32x8 (list 'i32x8 'int32 'u32x8))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16 'uint8))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8 'uint8))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8 'u8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16 'u8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16 'uint8))
                         (instr-sig 'i8x16 (list 'i8x16 'int8 'uint8))
                         (instr-sig 'i8x16 (list 'i8x16 'int8 'u8x16))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8 'uint16))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16 'uint16))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16 'u16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8 'u16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8 'uint16))
                         (instr-sig 'i16x8 (list 'i16x8 'int16 'uint16))
                         (instr-sig 'i16x8 (list 'i16x8 'int16 'u16x8))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4 'uint32))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32 'uint32))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32 'u32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4 'u32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4 'uint32))
                         (instr-sig 'i32x4 (list 'i32x4 'int32 'uint32))
                         (instr-sig 'i32x4 (list 'i32x4 'int32 'u32x4))
                        )]

    [(eq? mul_shr_r instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32 'uint8))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8 'uint8))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8 'u8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32 'u8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32 'uint8))
                         (instr-sig 'i8x32 (list 'i8x32 'int8 'uint8))
                         (instr-sig 'i8x32 (list 'i8x32 'int8 'u8x32))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16 'uint16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16 'uint16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16 'u16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16 'u16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16 'uint16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16 'uint16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16 'u16x16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8 'uint32))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32 'uint32))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32 'u32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8 'u32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8 'uint32))
                         (instr-sig 'i32x8 (list 'i32x8 'int32 'uint32))
                         (instr-sig 'i32x8 (list 'i32x8 'int32 'u32x8))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16 'uint8))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8 'uint8))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8 'u8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16 'u8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16 'uint8))
                         (instr-sig 'i8x16 (list 'i8x16 'int8 'uint8))
                         (instr-sig 'i8x16 (list 'i8x16 'int8 'u8x16))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8 'uint16))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16 'uint16))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16 'u16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8 'u16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8 'uint16))
                         (instr-sig 'i16x8 (list 'i16x8 'int16 'uint16))
                         (instr-sig 'i16x8 (list 'i16x8 'int16 'u16x8))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4 'uint32))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32 'uint32))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32 'u32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4 'u32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4 'uint32))
                         (instr-sig 'i32x4 (list 'i32x4 'int32 'uint32))
                         (instr-sig 'i32x4 (list 'i32x4 'int32 'u32x4))
                        )]

    [(eq? mul_w instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u32x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u64x4 (list 'u32x4 'u32x4))
                         (instr-sig 'i16x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i32x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i64x4 (list 'i32x4 'i32x4))
                        )]

    [(eq? mul_w-vs instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'uint8))
                         (instr-sig 'u32x8 (list 'u16x8 'uint16))
                         (instr-sig 'u64x4 (list 'u32x4 'uint32))
                         (instr-sig 'i16x16 (list 'i8x16 'int8))
                         (instr-sig 'i32x8 (list 'i16x8 'int16))
                         (instr-sig 'i64x4 (list 'i32x4 'int32))
                        )]

    [(eq? narrow instr) (list
                         (instr-sig 'u8x16 (list 'u16x16))
                         (instr-sig 'u16x8 (list 'u32x8))
                         (instr-sig 'u32x4 (list 'u64x4))
                         (instr-sig 'i8x16 (list 'i16x16))
                         (instr-sig 'i16x8 (list 'i32x8))
                         (instr-sig 'i32x4 (list 'i64x4))
                        )]

    [(eq? narrow_s instr) (list
                         (instr-sig 'u8x16 (list 'u16x16))
                         (instr-sig 'u16x8 (list 'u32x8))
                         (instr-sig 'u32x4 (list 'u64x4))
                         (instr-sig 'i8x16 (list 'i16x16))
                         (instr-sig 'u8x16 (list 'i16x16))
                         (instr-sig 'i16x8 (list 'i32x8))
                         (instr-sig 'u16x8 (list 'i32x8))
                         (instr-sig 'i32x4 (list 'i64x4))
                         (instr-sig 'u32x4 (list 'i64x4))
                        )]

    [(eq? shl instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? shl_r instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? shl_w instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u16x16 (list 'u8x16 'uint8))
                         (instr-sig 'u32x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u32x8 (list 'u16x8 'uint16))
                         (instr-sig 'u64x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u64x4 (list 'u32x4 'uint32))
                         (instr-sig 'i16x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i16x16 (list 'i8x16 'int8))
                         (instr-sig 'i32x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i32x8 (list 'i16x8 'int16))
                         (instr-sig 'i64x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i64x4 (list 'i32x4 'int32))
                        )]

    [(eq? shr instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? shr_r instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? shr_w instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u16x16 (list 'u8x16 'uint8))
                         (instr-sig 'u32x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u32x8 (list 'u16x8 'uint16))
                         (instr-sig 'u64x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u64x4 (list 'u32x4 'uint32))
                         (instr-sig 'i16x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i16x16 (list 'i8x16 'int8))
                         (instr-sig 'i32x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i32x8 (list 'i16x8 'int16))
                         (instr-sig 'i64x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i64x4 (list 'i32x4 'int32))
                        )]

    [(eq? sub instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? sub_h instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? sub_rh instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? sub_s instr) (list
                         (instr-sig 'u8x32 (list 'u8x32 'u8x32))
                         (instr-sig 'u8x32 (list 'u8x32 'uint8))
                         (instr-sig 'u16x16 (list 'u16x16 'u16x16))
                         (instr-sig 'u16x16 (list 'u16x16 'uint16))
                         (instr-sig 'u32x8 (list 'u32x8 'u32x8))
                         (instr-sig 'u32x8 (list 'u32x8 'uint32))
                         (instr-sig 'u64x4 (list 'u64x4 'u64x4))
                         (instr-sig 'u64x4 (list 'u64x4 'uint64))
                         (instr-sig 'i8x32 (list 'i8x32 'i8x32))
                         (instr-sig 'i8x32 (list 'i8x32 'int8))
                         (instr-sig 'i16x16 (list 'i16x16 'i16x16))
                         (instr-sig 'i16x16 (list 'i16x16 'int16))
                         (instr-sig 'i32x8 (list 'i32x8 'i32x8))
                         (instr-sig 'i32x8 (list 'i32x8 'int32))
                         (instr-sig 'i64x4 (list 'i64x4 'i64x4))
                         (instr-sig 'i64x4 (list 'i64x4 'int64))
                         (instr-sig 'u8x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u8x16 (list 'u8x16 'uint8))
                         (instr-sig 'u16x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u16x8 (list 'u16x8 'uint16))
                         (instr-sig 'u32x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u32x4 (list 'u32x4 'uint32))
                         (instr-sig 'u64x2 (list 'u64x2 'u64x2))
                         (instr-sig 'u64x2 (list 'u64x2 'uint64))
                         (instr-sig 'i8x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i8x16 (list 'i8x16 'int8))
                         (instr-sig 'i16x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i16x8 (list 'i16x8 'int16))
                         (instr-sig 'i32x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i32x4 (list 'i32x4 'int32))
                         (instr-sig 'i64x2 (list 'i64x2 'i64x2))
                         (instr-sig 'i64x2 (list 'i64x2 'int64))
                        )]

    [(eq? sub_w instr) (list
                         (instr-sig 'u16x16 (list 'u8x16 'u8x16))
                         (instr-sig 'u16x16 (list 'u8x16 'uint8))
                         (instr-sig 'u32x8 (list 'u16x8 'u16x8))
                         (instr-sig 'u32x8 (list 'u16x8 'uint16))
                         (instr-sig 'u64x4 (list 'u32x4 'u32x4))
                         (instr-sig 'u64x4 (list 'u32x4 'uint32))
                         (instr-sig 'i16x16 (list 'i8x16 'i8x16))
                         (instr-sig 'i16x16 (list 'i8x16 'int8))
                         (instr-sig 'i32x8 (list 'i16x8 'i16x8))
                         (instr-sig 'i32x8 (list 'i16x8 'int16))
                         (instr-sig 'i64x4 (list 'i32x4 'i32x4))
                         (instr-sig 'i64x4 (list 'i32x4 'int32))
                        )]

    [(eq? widen instr) (list
                         (instr-sig 'u16x16 (list 'u8x16))
                         (instr-sig 'u32x8 (list 'u16x8))
                         (instr-sig 'u64x4 (list 'u32x4))
                         (instr-sig 'i16x16 (list 'i8x16))
                         (instr-sig 'i32x8 (list 'i16x8))
                         (instr-sig 'i64x4 (list 'i32x4))
                        )]

    [(eq? reinterpret instr) (list
                         (instr-sig 'i8x16 (list 'u8x16))
                         (instr-sig 'u8x16 (list 'i8x16))
                         (instr-sig 'i16x8 (list 'u16x8))
                         (instr-sig 'u16x8 (list 'i16x8))
                         (instr-sig 'i32x4 (list 'u32x4))
                         (instr-sig 'u32x4 (list 'i32x4))
                         (instr-sig 'i64x2 (list 'u64x2))
                         (instr-sig 'u64x2 (list 'i64x2))
                         (instr-sig 'i8x32 (list 'u8x32))
                         (instr-sig 'u8x32 (list 'i8x32))
                         (instr-sig 'i16x16 (list 'u16x16))
                         (instr-sig 'u16x16 (list 'i16x16))
                         (instr-sig 'i32x8 (list 'u32x8))
                         (instr-sig 'u32x8 (list 'i32x8))
                         (instr-sig 'i64x4 (list 'u64x4))
                         (instr-sig 'u64x4 (list 'i64x4))
                         )]

    [(eq? lo instr) (list
                         (instr-sig 'u8x16 (list 'u8x32))
                         (instr-sig 'u16x8 (list 'u16x16))
                         (instr-sig 'u32x4 (list 'u32x8))
                         (instr-sig 'u64x2 (list 'u64x4))
                         (instr-sig 'i8x16 (list 'i8x32))
                         (instr-sig 'i16x8 (list 'i16x16))
                         (instr-sig 'i32x4 (list 'i32x8))
                         (instr-sig 'i64x2 (list 'i64x4))
                        )]

    [(eq? hi instr) (list
                         (instr-sig 'u8x16 (list 'u8x32))
                         (instr-sig 'u16x8 (list 'u16x16))
                         (instr-sig 'u32x4 (list 'u32x8))
                         (instr-sig 'u64x2 (list 'u64x4))
                         (instr-sig 'i8x16 (list 'i8x32))
                         (instr-sig 'i16x8 (list 'i16x16))
                         (instr-sig 'i32x4 (list 'i32x8))
                         (instr-sig 'i64x2 (list 'i64x4))
                        )]

    [else (error "(fpir:instr-form) Unknown instruction:" instr)]))

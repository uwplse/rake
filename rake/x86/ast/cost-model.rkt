#lang rosette/safe

(require
  (only-in racket/base error)
  rosette/lib/match
  rake/x86/ast/types
  rake/x86/ast/visitor
  rosette/lib/destruct
)

(provide (prefix-out x86: (all-defined-out)))

;; Auto-generated cost model of Skylake throughput (CPI).
(define (instr-cost instr)
  (cond
    [(eq? instr x86:reinterpret) 0]
    [(eq? instr x86:packssdw) 1]
    [(eq? instr x86:packsswb) 1]
    [(eq? instr x86:packuswb) 1]
    [(eq? instr x86:paddb) 0.33]
    [(eq? instr x86:paddd) 0.33]
    [(eq? instr x86:paddq) 0.33]
    [(eq? instr x86:paddsb) 0.5]
    [(eq? instr x86:paddsw) 0.5]
    [(eq? instr x86:paddusb) 0.5]
    [(eq? instr x86:paddusw) 0.5]
    [(eq? instr x86:paddw) 0.33]
    [(eq? instr x86:pand) 0.33]
    [(eq? instr x86:pandn) 0.33]
    [(eq? instr x86:pavgb) 0.5]
    [(eq? instr x86:pavgw) 0.5]
    [(eq? instr x86:pcmpeqb) 0.5]
    [(eq? instr x86:pcmpeqd) 0.5]
    [(eq? instr x86:pcmpeqw) 0.5]
    [(eq? instr x86:pcmpgtb) 0.5]
    [(eq? instr x86:pcmpgtd) 0.5]
    [(eq? instr x86:pcmpgtw) 0.5]
    [(eq? instr x86:pmaddwd) 0.5]
    [(eq? instr x86:pmaxsw) 0.5]
    [(eq? instr x86:pmaxub) 0.5]
    [(eq? instr x86:pminsw) 0.5]
    [(eq? instr x86:pminub) 0.5]
    [(eq? instr x86:pmulhuw) 0.5]
    [(eq? instr x86:pmulhw) 0.5]
    [(eq? instr x86:pmullw) 0.5]
    [(eq? instr x86:pmullw-vs) 1.5]
    [(eq? instr x86:pmuludq) 0.5]
    [(eq? instr x86:pmuludq-vs) 1.5]
    [(eq? instr x86:por) 0.33]
    [(eq? instr x86:psadbw) 1]
    [(eq? instr x86:pshufd) 1]
    [(eq? instr x86:pshufhw) 1]
    [(eq? instr x86:pshuflw) 1]
    [(eq? instr x86:pslld) 0.5]
    [(eq? instr x86:pslldq) 1]
    [(eq? instr x86:psllq) 0.5]
    [(eq? instr x86:psllw) 0.5]
    [(eq? instr x86:psrad) 0.5]
    [(eq? instr x86:psraw) 0.5]
    [(eq? instr x86:psrld) 0.5]
    [(eq? instr x86:psrldq) 1]
    [(eq? instr x86:psrlq) 0.5]
    [(eq? instr x86:psrlw) 0.5]
    [(eq? instr x86:psubb) 0.33]
    [(eq? instr x86:psubd) 0.33]
    [(eq? instr x86:psubq) 0.33]
    [(eq? instr x86:psubsb) 0.5]
    [(eq? instr x86:psubsw) 0.5]
    [(eq? instr x86:psubusb) 0.5]
    [(eq? instr x86:psubusw) 0.5]
    [(eq? instr x86:psubw) 0.33]
    [(eq? instr x86:punpckhbw) 1]
    [(eq? instr x86:punpckhdq) 1]
    [(eq? instr x86:punpckhqdq) 1]
    [(eq? instr x86:punpckhwd) 1]
    [(eq? instr x86:punpcklbw) 1]
    [(eq? instr x86:punpckldq) 1]
    [(eq? instr x86:punpcklqdq) 1]
    [(eq? instr x86:punpcklwd) 1]
    [(eq? instr x86:pxor) 0.33]
    [(eq? instr x86:resize) 0]
    [(eq? instr x86:vbroadcasti128) 0.5]
    [(eq? instr x86:vpabsb) 0.5]
    [(eq? instr x86:vpabsd) 0.5]
    [(eq? instr x86:vpabsw) 0.5]
    [(eq? instr x86:vpackssdw) 1]
    [(eq? instr x86:vpacksswb) 1]
    [(eq? instr x86:vpackusdw) 1]
    [(eq? instr x86:vpackuswb) 1]
    [(eq? instr x86:vpaddb) 0.33]
    [(eq? instr x86:vpaddd) 0.33]
    [(eq? instr x86:vpaddq) 0.33]
    [(eq? instr x86:vpaddsb) 0.5]
    [(eq? instr x86:vpaddsw) 0.5]
    [(eq? instr x86:vpaddusb) 0.5]
    [(eq? instr x86:vpaddusw) 0.5]
    [(eq? instr x86:vpaddw) 0.33]
    [(eq? instr x86:vpalignr) 1]
    [(eq? instr x86:vpand) 0.33]
    [(eq? instr x86:vpandn) 0.33]
    [(eq? instr x86:vpavgb) 0.5]
    [(eq? instr x86:vpavgw) 0.5]
    [(eq? instr x86:vpblendd) 0.33]
    [(eq? instr x86:vpblendd_128) 0.33]
    [(eq? instr x86:vpblendvb) 0.66]
    [(eq? instr x86:vpblendw) 1]
    [(eq? instr x86:vpbroadcastb) 1]
    [(eq? instr x86:vpbroadcastb_128) 1]
    [(eq? instr x86:vpbroadcastd) 1]
    [(eq? instr x86:vpbroadcastd_128) 1]
    [(eq? instr x86:vpbroadcastq) 1]
    [(eq? instr x86:vpbroadcastq_128) 1]
    [(eq? instr x86:vpbroadcastw) 1]
    [(eq? instr x86:vpbroadcastw_128) 1]
    [(eq? instr x86:vpcmpeqb) 0.5]
    [(eq? instr x86:vpcmpeqd) 0.5]
    [(eq? instr x86:vpcmpeqq) 0.5]
    [(eq? instr x86:vpcmpeqw) 0.5]
    [(eq? instr x86:vpcmpgtb) 0.5]
    [(eq? instr x86:vpcmpgtd) 0.5]
    [(eq? instr x86:vpcmpgtq) 1]
    [(eq? instr x86:vpcmpgtw) 0.5]
    [(eq? instr x86:vperm2f128) 1]
    [(eq? instr x86:vperm2i128) 1]
    [(eq? instr x86:vpermd) 1]
    [(eq? instr x86:vpermq) 1]
    [(eq? instr x86:vphaddd) 2]
    [(eq? instr x86:vphaddsw) 2]
    [(eq? instr x86:vphaddw) 2]
    [(eq? instr x86:vphsubd) 2]
    [(eq? instr x86:vphsubsw) 2]
    [(eq? instr x86:vphsubw) 2]
    [(eq? instr x86:vpmaddubsw) 0.5]
    [(eq? instr x86:vpmaddwd) 0.5]
    [(eq? instr x86:vpmaxsb) 0.5]
    [(eq? instr x86:vpmaxsd) 0.5]
    [(eq? instr x86:vpmaxsw) 0.5]
    [(eq? instr x86:vpmaxub) 0.5]
    [(eq? instr x86:vpmaxud) 0.5]
    [(eq? instr x86:vpmaxuw) 0.5]
    [(eq? instr x86:vpminsb) 0.5]
    [(eq? instr x86:vpminsd) 0.5]
    [(eq? instr x86:vpminsw) 0.5]
    [(eq? instr x86:vpminub) 0.5]
    [(eq? instr x86:vpminud) 0.5]
    [(eq? instr x86:vpminuw) 0.5]
    [(eq? instr x86:vpmovsxbd) 1]
    [(eq? instr x86:vpmovsxbq) 1]
    [(eq? instr x86:vpmovsxbw) 1]
    [(eq? instr x86:vpmovsxdq) 1]
    [(eq? instr x86:vpmovsxwd) 1]
    [(eq? instr x86:vpmovsxwq) 1]
    [(eq? instr x86:vpmovzxbd) 1]
    [(eq? instr x86:vpmovzxbq) 1]
    [(eq? instr x86:vpmovzxbw) 1]
    [(eq? instr x86:vpmovzxbw_s) 1]
    [(eq? instr x86:vpmovzxdq) 1]
    [(eq? instr x86:vpmovzxwd) 1]
    [(eq? instr x86:vpmovzxwq) 1]
    [(eq? instr x86:vpmuldq) 0.5]
    [(eq? instr x86:vpmuldq-vs) 0.5]
    [(eq? instr x86:vpmulhrsw) 0.5]
    [(eq? instr x86:vpmulhuw) 0.5]
    [(eq? instr x86:vpmulhw) 0.5]
    [(eq? instr x86:vpmulld) 0.66]
    [(eq? instr x86:vpmulld-vs) 1.66]
    [(eq? instr x86:vpmullw) 0.5]
    [(eq? instr x86:vpmullw-vs) 1.5]
    [(eq? instr x86:vpmuludq) 0.5]
    [(eq? instr x86:vpmuludq-vs) 0.5]
    [(eq? instr x86:vpor) 0.33]
    [(eq? instr x86:vpsadbw) 1]
    [(eq? instr x86:vpshufb) 1]
    [(eq? instr x86:vpshufd) 1]
    [(eq? instr x86:vpshufhw) 1]
    [(eq? instr x86:vpshuflw) 1]
    [(eq? instr x86:vpsignb) 0.5]
    [(eq? instr x86:vpsignd) 0.5]
    [(eq? instr x86:vpsignw) 0.5]
    [(eq? instr x86:vpslld) 0.5]
    [(eq? instr x86:vpslldq) 1]
    [(eq? instr x86:vpsllq) 0.5]
    [(eq? instr x86:vpsllvd) 0.5]
    [(eq? instr x86:vpsllvq) 0.5]
    [(eq? instr x86:vpsllw) 0.5]
    [(eq? instr x86:vpsrad) 0.5]
    [(eq? instr x86:vpsravd) 0.5]
    [(eq? instr x86:vpsraw) 0.5]
    [(eq? instr x86:vpsrld) 0.5]
    [(eq? instr x86:vpsrldq) 1]
    [(eq? instr x86:vpsrlq) 0.5]
    [(eq? instr x86:vpsrlvd) 0.5]
    [(eq? instr x86:vpsrlvq) 0.5]
    [(eq? instr x86:vpsrlw) 0.5]
    [(eq? instr x86:vpsubb) 0.33]
    [(eq? instr x86:vpsubd) 0.33]
    [(eq? instr x86:vpsubq) 0.33]
    [(eq? instr x86:vpsubsb) 0.5]
    [(eq? instr x86:vpsubsw) 0.5]
    [(eq? instr x86:vpsubusb) 0.5]
    [(eq? instr x86:vpsubusw) 0.5]
    [(eq? instr x86:vpsubw) 0.33]
    [(eq? instr x86:vpunpckhbw) 1]
    [(eq? instr x86:vpunpckhdq) 1]
    [(eq? instr x86:vpunpckhqdq) 1]
    [(eq? instr x86:vpunpckhwd) 1]
    [(eq? instr x86:vpunpcklbw) 1]
    [(eq? instr x86:vpunpckldq) 1]
    [(eq? instr x86:vpunpcklqdq) 1]
    [(eq? instr x86:vpunpcklwd) 1]
    [(eq? instr x86:vpxor) 0.33]
    [else (error "Unknown instruction (x86:instr-cost):" instr)]))
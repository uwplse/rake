#!/bin/bash

basedir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

benchmarks=("conv3x3a16" "conv3x3a32" "gaussian5x5" "sobel3x3")

if [ $# -eq 0 ]
  	then
    	outF="results.csv"
	else
		outF=$1
fi

rm -f $outF

for benchmark in "${benchmarks[@]}"; do
  bm_dir="$basedir/$benchmark"

  printf "Simulating %s (Halide version) ...\n" $benchmark
  $bm_dir/halide/run-sim |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Halide"

  printf "Simulating %s (Halide simplified version) ...\n" $benchmark
  $bm_dir/halide/run-sim-simple |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Halide Simple"

  # Run C Intrinsics versions
  printf "Simulating %s (Manual C version) ...\n" $benchmark
  $bm_dir/hvx/run-sim-hvx64 |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Manual C"
  $bm_dir/hvx/run-sim-hvx128 |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Manual C"

  # Run LLVM versions
  printf "Simulating %s (Manual LLVM version) ...\n" $benchmark
  $bm_dir/hvx/run-sim-hvx64-llvm |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Manual LLVM"
  $bm_dir/hvx/run-sim-hvx128-llvm |& python $basedir/parseSimulatorOutput.py "${outF}" "${benchmark}" "Manual LLVM"
done

# 1. Email Shoaib (30 minutes) 10-10.30
# 2. Parse output to csv (1 hour) 10.30 - 11.30
# 3. Sim asm version (1 hour) 12.30 - 1.30
# 4. Generate simulation analysis html file of each benchmark (1 hour)
#----
# 6. Review 3 other benchmarks (3-5 hours) 1.30 - 5
#----
# 6. Run benchmarks on device to confirm numbers (1 hour) 6-7
# 7. Re-write interesting algorithms in new IR (2 hours)

echo "done"